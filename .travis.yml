matrix:
  include:
  - os: linux
    language: android
    licenses:
    - android-sdk-preview-license-.+
    - android-sdk-license-.+
    - google-gdk-license-.+
    android:
      components:
      - tools
      - platform-tools
      - build-tools-27.0.3
      - android-27
      - sys-img-armeabi-v7a-google_apis-25
      - extra-android-m2repository
      - extra-google-m2repository
      - extra-google-android-support
    jdk: oraclejdk8
    addons:
      apt:
        sources:
        - ubuntu-toolchain-r-test
        packages:
        - libstdc++6
        - fonts-droid
    before_script:
    - git clone https://github.com/flutter/flutter.git -b stable --depth 1
    before_install:
    - yes | sdkmanager "platforms;android-28"
    script:
    - "./flutter/bin/flutter build apk"
    - flutter/bin/flutter test test

  - os: osx
    osx_image: xcode11.3
    language: generic
    before_script:
    - brew update
    - brew install --HEAD usbmuxd
    - brew unlink usbmuxd
    - brew link usbmuxd
    - brew link --overwrite python
    - brew install --HEAD libimobiledevice
    - brew install ideviceinstaller
    - brew install ios-deploy
    - git clone https://github.com/flutter/flutter.git -b stable --depth 1
    script:
    - flutter/bin/flutter pub get
    - gem install cocoapods
    - (cd ios; rm -rf Pods; rm Podfile.lock) || true
    - flutter/bin/flutter build ios --debug --no-codesign
    - flutter/bin/flutter test test

cache:
  directories:
  - "$HOME/.pub-cache"